<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Products — Mania Print</title>
  <meta name="description" content="All products and standard offerings — Mania Print"/>
  <link rel="stylesheet" href="../styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a class="logo" href="../index.html">Mania Print</a>
      <nav class="nav" id="nav">
        <a href="../index.html#services">Services</a>
        <a href="../index.html#gallery">Gallery</a>
        <a href="../index.html#pricing">Pricing</a>
        <a href="../index.html#contact">Contact</a>
        <a href="../products/index.html">Products</a>
      </nav>

      <div style="display:flex; gap:8px; align-items:center;">
        <a class="cta" href="../index.html">Back to Home</a>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="tools-hero">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:20px; flex-wrap:wrap;">
        <div>
          <h1>Products</h1>
          <p class="small">Standard parts, bundles and starter kits you can order straight away. This page loads from <code>products.json</code> so you can update offerings easily.</p>
        </div>
      </div>

      <div class="controls" style="margin-top:12px;">
        <div class="search" role="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2"/>
          </svg>
          <input id="q" placeholder="Search title, desc or tag" />
        </div>

        <div id="sort-dropdown" class="custom-select">
          <button class="custom-select-button">Title (A → Z) ▾</button>
          <div class="custom-select-options hidden">
            <div class="custom-select-option" data-value="alpha">Title (A → Z)</div>
            <div class="custom-select-option" data-value="alpha-desc">Title (Z → A)</div>
            <div class="custom-select-option" data-value="price-asc">Price (low → high)</div>
            <div class="custom-select-option" data-value="price-desc">Price (high → low)</div>
          </div>
        </div>
      </div>
    </section>

    <div id="grid" class="cards-grid" aria-live="polite" style="margin-top:16px; display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px;"></div>
    <div id="empty" class="small" style="margin-top:40px; display:none;">No products found.</div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <small>© Mania Print — built for fun. Hosted wherever you like.</small>
    </div>
  </footer>

  <script>
  (function(){
    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const empty = document.getElementById('empty');

    let products = [];
    let sortMode = 'alpha';

    function escapeHtml(s){ if(!s && s !== 0) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#39;"); }

    function renderCard(p){
      const price = (typeof p.price === 'number') ? ('$' + p.price.toFixed(2)) : (p.price || '');
      const tags = (p.tags || []).map(t => `<span class="chip">${escapeHtml(t)}</span>`).join(' ');
      return `<article class="tool-card">
        <div class="card-top" style="display:flex;gap:12px;align-items:flex-start">
          <div style="width:64px;height:64px;border-radius:8px;background:linear-gradient(135deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center">
            ${p.img ? `<img src="${escapeHtml(p.img)}" alt="${escapeHtml(p.title)}" style="max-width:100%;max-height:100%;border-radius:6px">` : `<div style="font-weight:800">${escapeHtml((p.title||'')[0]||'?')}</div>`}
          </div>
          <div style="flex:1;min-width:0;">
            <h3 style="margin:0 0 6px 0;">${escapeHtml(p.title)}</h3>
            <p class="card-desc">${escapeHtml(p.desc || '')}</p>
            <div style="margin-top:8px">${tags}</div>
          </div>
        </div>
        <div class="card-actions" style="display:flex;gap:8px;align-items:center;margin-top:12px;">
          <a class="btn small primary" href="../index.html#contact" onclick="location.href='../index.html#contact'">Order</a>
          <button class="btn small ghost view-details" data-id="${escapeHtml(p.id || '')}">Details</button>
          <div style="margin-left:auto;font-weight:800">${price}</div>
        </div>
      </article>`;
    }

    async function loadProducts(){
      try {
        const r = await fetch('products.json', {cache:'no-cache'});
        if (!r.ok) throw new Error('products.json not found');
        const raw = await r.json();
        products = raw;
        applyFilters();
      } catch (err){
        console.error(err);
        grid.innerHTML = `<div style="color:var(--muted); padding:18px;">Failed to load products. Drop a products.json in site root.</div>`;
      }
    }

    function applyFilters(){
      const qv = (q.value || '').trim().toLowerCase();
      let fl = products.slice();

      if (qv) {
        fl = fl.filter(p => ((p.title||'') + ' ' + (p.desc||'') + ' ' + (p.tags||[]).join(' ')).toLowerCase().includes(qv));
      }

      if (sortMode === 'alpha') fl.sort((a,b)=> (a.title||'').localeCompare(b.title||''));
      else if (sortMode === 'alpha-desc') fl.sort((a,b)=> (b.title||'').localeCompare(a.title||''));
      else if (sortMode === 'price-asc') fl.sort((a,b)=> (a.price||0) - (b.price||0));
      else if (sortMode === 'price-desc') fl.sort((a,b)=> (b.price||0) - (a.price||0));

      if (!fl.length){ grid.innerHTML=''; empty.style.display='block'; return; }
      empty.style.display='none';
      grid.innerHTML = fl.map(renderCard).join('');
      attachDetailHandlers();
    }

    function attachDetailHandlers(){
      document.querySelectorAll('.view-details').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const id = e.currentTarget.getAttribute('data-id');
          const p = products.find(x => String(x.id) === String(id));
          if (!p) return showModal('Not found');
          showModal(`<strong>${escapeHtml(p.title)}</strong><p>${escapeHtml(p.desc||'')}</p><p><strong>Price:</strong> ${p.price ? '$'+p.price.toFixed(2) : 'Contact'}</p>`);
        });
      });
    }

    // tiny modal
    function showModal(html){
      let m = document.getElementById('simple-modal');
      if (!m) {
        m = document.createElement('div');
        m.id = 'simple-modal';
        m.style.position='fixed';
        m.style.left=0; m.style.top=0; m.style.right=0; m.style.bottom=0;
        m.style.display='flex'; m.style.alignItems='center'; m.style.justifyContent='center';
        m.style.background='rgba(0,0,0,0.6)';
        m.innerHTML = `<div style="max-width:680px;background:var(--panel);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)"><div id="simple-modal-content"></div><div style="text-align:right;margin-top:12px"><button id="closeModal" class="btn">Close</button></div></div>`;
        document.body.appendChild(m);
        document.getElementById('closeModal').addEventListener('click', ()=>m.remove());
      }
      document.getElementById('simple-modal-content').innerHTML = html;
    }

    // sort dropdown basic
    const selBtn = document.querySelector('.custom-select-button');
    const opts = document.querySelectorAll('.custom-select-option');
    if (selBtn){
      selBtn.addEventListener('click', ()=> {
        const el = document.querySelector('.custom-select-options');
        el.classList.toggle('hidden');
      });
      opts.forEach(o=>{
        o.addEventListener('click', ()=>{
          sortMode = o.getAttribute('data-value');
          document.querySelector('.custom-select-button').textContent = o.textContent + ' ▾';
          document.querySelector('.custom-select-options').classList.add('hidden');
          applyFilters();
        });
      });
    }

    q.addEventListener('input', ()=> setTimeout(applyFilters, 200));

    loadProducts();
  })();
  </script>
</body>
</html>
